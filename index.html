<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomonalyze | Akƒ±llƒ± Verimlilik Analizi</title>
    <style>
        :root { --bg-color: #f0f2f5; --cont-bg: #ffffff; --text-color: #2c3e50; --border: #ddd; --accent: #9b59b6; }
        .dark-mode { --bg-color: #1a1a1a; --cont-bg: #2d2d2d; --text-color: #e0e0e0; --border: #444; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg-color); color: var(--text-color); padding: 20px; transition: 0.3s; margin: 0; display: flex; flex-direction: column; align-items: center; }
        .main-layout { display: flex; gap: 20px; width: 95%; max-width: 1000px; flex-wrap: wrap; justify-content: center; margin-top: 20px; }
        .container { background-color: var(--cont-bg); padding: 25px; border-radius: 12px; box-shadow: 0 8px 16px rgba(0,0,0,0.1); flex: 1; min-width: 350px; position: relative; border: 1px solid var(--border); }
        
        .brand-header { text-align: center; margin-bottom: 10px; }
        .brand-header h1 { font-size: 36px; color: var(--accent); margin: 0; }
        .progress-container { width: 100%; height: 8px; background: #eee; border-radius: 5px; margin: 15px 0; overflow: hidden; }
        #progress-bar { width: 0%; height: 100%; background: linear-gradient(90deg, #9b59b6, #3498db); transition: 0.3s; }
        
        #timer-display { font-size: 72px; font-weight: bold; text-align: center; color: #e74c3c; margin: 10px 0; }
        button { color: white; padding: 12px 18px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-start { background-color: #3498db; } .btn-mola { background-color: #2ecc71; } .btn-analiz { background-color: #e67e22; width: 100%; margin-top: 10px; }
        input { padding: 12px; border: 2px solid var(--border); border-radius: 8px; background: var(--cont-bg); color: var(--text-color); width: 100%; box-sizing: border-box; }

        /* G√∂rev Listesi Sade Stil */
        #todo-list { list-style: none; padding: 0; margin-top: 15px; }
        .todo-item { display: flex; align-items: center; background: rgba(0,0,0,0.03); padding: 10px; margin-bottom: 5px; border-radius: 8px; }
        .todo-item input { width: 18px; height: 18px; margin-right: 10px; }

        /* Tabloyu Sadece Veri Varsa G√∂ster */
        .history-container { width: 95%; max-width: 1000px; margin-top: 30px; background: var(--cont-bg); padding: 20px; border-radius: 12px; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid var(--border); font-size: 14px; }
    </style>
</head>
<body>

    <div class="brand-header">
        <h1>üìä Pomonalyze</h1>
        <p>Verimliliƒüini Analiz Et, Akƒ±≈üa Ge√ß</p>
    </div>

    <div class="main-layout">
        <div class="container">
            <div class="progress-container"><div id="progress-bar"></div></div>
            <div style="text-align:center; font-weight:bold;">Hedef: <span id="target-minutes">{{ current_target_time }}</span> Dakika</div>
            <div id="timer-display">00:00</div>
            <div style="display:flex; justify-content:center; gap:10px; margin-bottom:20px;">
                <button class="btn-start" onclick="startTimer()">Ba≈ülat</button>
                <button style="background-color:#95a5a6;" onclick="stopTimer()">Sƒ±fƒ±rla</button>
                <button class="btn-mola" onclick="setTimer(5)">Mola</button>
            </div>
            <form action="{{ url_for('complete') }}" method="POST" onsubmit="saveToHistory()">
                <input type="number" id="actual_input" name="actual_duration" placeholder="Ka√ß dakika odaklandƒ±n?" required>
                <button type="submit" class="btn-analiz">Analiz Et & Kaydet</button>
            </form>
        </div>

        <div class="container">
            <h2>üìù G√ºnl√ºk Odak Noktalarƒ±</h2>
            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <input type="text" id="todo-input" placeholder="Yeni bir g√∂rev yaz...">
                <button style="background-color: var(--accent);" onclick="addTodo()">Ekle</button>
            </div>
            <ul id="todo-list"></ul>
        </div>
    </div>

    <div class="history-container">
        <h3 style="margin-top:0;">üìà √áalƒ±≈üma Ge√ßmi≈üi</h3>
        <table id="history-table">
            <thead><tr><th>Tarih</th><th>Hedef</th><th>Ger√ßek</th><th>Durum</th></tr></thead>
            <tbody id="history-body"></tbody>
        </table>
    </div>

    <audio id="alarm-sound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

    <script>
        let timer; let timeLeft; let totalTime;
        const display = document.getElementById('timer-display');
        const progressBar = document.getElementById('progress-bar');
        const targetMinutesDisp = document.getElementById('target-minutes');
        const alarm = document.getElementById('alarm-sound');

        function updateDisplay(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            display.innerText = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            if (totalTime) {
                const perc = ((totalTime - seconds) / totalTime) * 100;
                progressBar.style.width = perc + "%";
            }
        }

        function setTimer(mins) { stopTimer(); timeLeft = mins * 60; totalTime = timeLeft; updateDisplay(timeLeft); }
        function startTimer() {
            if (timer) return;
            if (!timeLeft) { timeLeft = parseFloat(targetMinutesDisp.innerText) * 60; totalTime = timeLeft; }
            timer = setInterval(() => {
                timeLeft--; updateDisplay(timeLeft);
                if (timeLeft <= 0) { clearInterval(timer); timer = null; alarm.play(); alert("S√ºren doldu!"); }
            }, 1000);
        }
        function stopTimer() { clearInterval(timer); timer = null; timeLeft = parseFloat(targetMinutesDisp.innerText) * 60; totalTime = 0; progressBar.style.width = "0%"; updateDisplay(timeLeft); }
        
        function addTodo() {
            const input = document.getElementById('todo-input');
            if (!input.value.trim()) return;
            const li = document.createElement('li');
            li.className = 'todo-item';
            li.innerHTML = `<input type="checkbox" onclick="this.parentElement.style.opacity = this.checked ? '0.4' : '1'"> <span>${input.value}</span>`;
            document.getElementById('todo-list').appendChild(li);
            input.value = "";
        }

        function saveToHistory() {
            const historyData = { 
                date: new Date().toLocaleTimeString('tr-TR'), 
                target: targetMinutesDisp.innerText, 
                actual: document.getElementById('actual_input').value 
            };
            let history = JSON.parse(localStorage.getItem('pomoHistory') || '[]');
            history.unshift(historyData);
            localStorage.setItem('pomoHistory', JSON.stringify(history.slice(0, 5)));
        }

        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('pomoHistory') || '[]');
            const body = document.getElementById('history-body');
            body.innerHTML = history.map(row => `<tr><td>${row.date}</td><td>${row.target}</td><td>${row.actual}</td><td>${parseInt(row.actual) >= parseInt(row.target) ? '‚úÖ' : '‚ö†Ô∏è'}</td></tr>`).join('');
        }

        window.onload = loadHistory;
        updateDisplay(parseFloat(targetMinutesDisp.innerText) * 60);
    </script>
</body>
</html>